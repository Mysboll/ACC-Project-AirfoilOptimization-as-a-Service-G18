#cloud-config for WORKER ##

apt_update: true
apt_upgrade: true
packages:
 - python-pip
 - python-dev
 - build-essential
byobu_default: system


runcmd:
 - sudo apt-get -y update
 - sudo apt-get -y install python3-pip
 - pip3 install celery
 - curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
 - sudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable"
 - sudo apt-get -y update
 - apt-cache policy docker-ce
 - sudo apt-get install -y docker-ce
 - sudo systemctl enable docker
 - sudo systemctl start docker
 - sudo git clone https://github.com/Mysboll/applied_cloudcomputing_project_group18.git
 - sudo cd applied_cloudcomputing_project_group18
 - sudo checkout dev
 - sudo docker pull soberbot94/fenicsproject-airfoil:latest
 - sudo docker run --name airfoil -d -it soberbot94/fenicsproject-airfoil:latest
 - sudo celery -A docker_call worker -l info